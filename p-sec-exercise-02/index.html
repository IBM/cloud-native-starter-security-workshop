
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="IBM Developer">
      
      
        <link rel="canonical" href="https://ibm.github.io/cloud-native-starter-security-workshop/p-sec-exercise-02/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.5">
    
    
      
        <title>Lab 2. Secure microservices using Authentication with mTLS - Java Microservices with Security Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CIBM+Plex+Mono&display=fallback">
        <style>:root{--md-text-font-family:"IBM Plex Sans";--md-code-font-family:"IBM Plex Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#secure-microservices-with-strict-mtls" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Java Microservices with Security Workshop" class="md-header__button md-logo" aria-label="Java Microservices with Security Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="180" height="85" version="1.1" viewBox="0 0 180 85"><title>ibm_8bar_gray10_on_teal90</title><g id="Page-1" fill="none" fill-rule="evenodd" stroke="none" stroke-width="1"><g id="ibm_8bar_gray10_on_teal90" fill-rule="nonzero"><rect id="Rectangle-5-Copy-14" width="180" height="85" x="0" y="0" fill="#000"/><g id="8-bar-/-reverse" fill="#F3F3F3" transform="translate(8.500000, 9.500000)"><path id="Combined-Shape" d="M31.6944444,60.7545455 L31.6944444,64.8707071 L1.70388148e-11,64.8707071 L1.70388148e-11,60.7545455 L31.6944444,60.7545455 Z M80.7590909,60.7545455 C77.7542929,63.3065657 73.8439394,64.8707071 69.5631313,64.8707071 L69.5631313,64.8707071 L36.2222222,64.8707071 L36.2222222,60.7545455 L80.7590909,60.7545455 Z M113.194444,60.7133838 L113.194444,64.8295455 L90.5555556,64.8295455 L90.5555556,60.7133838 L113.194444,60.7133838 Z M163,60.7133838 L163,64.8295455 L140.361111,64.8295455 L140.361111,60.7133838 L163,60.7133838 Z M128.218434,60.7133838 L126.777778,64.7883838 L125.337121,60.7133838 L128.218434,60.7133838 Z M86.2747475,52.1106061 C85.8631313,53.5512626 85.2868687,54.9507576 84.5459596,56.2267677 L84.5459596,56.2267677 L36.2222222,56.2267677 L36.2222222,52.1106061 L86.2747475,52.1106061 Z M31.6944444,52.1106061 L31.6944444,56.2267677 L1.70388148e-11,56.2267677 L1.70388148e-11,52.1106061 L31.6944444,52.1106061 Z M113.194444,52.0694444 L113.194444,56.1856061 L90.5555556,56.1856061 L90.5555556,52.0694444 L113.194444,52.0694444 Z M163,52.0694444 L163,56.1856061 L140.361111,56.1856061 L140.361111,52.0694444 L163,52.0694444 Z M131.264394,52.0694444 L129.823737,56.1856061 L123.731818,56.1856061 L122.291162,52.0694444 L131.264394,52.0694444 Z M22.6388889,43.4666667 L22.6388889,47.5828283 L9.05555556,47.5828283 L9.05555556,43.4666667 L22.6388889,43.4666667 Z M58.8611111,43.4666667 L58.8611111,47.5828283 L45.2777778,47.5828283 L45.2777778,43.4666667 L58.8611111,43.4666667 Z M86.3570707,43.4666667 C86.6863636,44.7838384 86.8510101,46.1833333 86.8510101,47.5828283 L86.8510101,47.5828283 L72.4444444,47.5828283 L72.4444444,43.4666667 L86.3570707,43.4666667 Z M113.194444,43.4255051 L113.194444,47.5416667 L99.6111111,47.5416667 L99.6111111,43.4255051 L113.194444,43.4255051 Z M153.944444,43.4255051 L153.944444,47.5416667 L140.361111,47.5416667 L140.361111,43.4255051 L153.944444,43.4255051 Z M134.310354,43.4255051 L132.869697,47.5416667 L120.685859,47.5416667 L119.245202,43.4255051 L134.310354,43.4255051 Z M22.6388889,34.8227273 L22.6388889,38.9388889 L9.05555556,38.9388889 L9.05555556,34.8227273 L22.6388889,34.8227273 Z M81.2118687,34.8227273 C82.5290404,35.9752525 83.640404,37.3747475 84.5459596,38.9388889 L84.5459596,38.9388889 L45.2777778,38.9388889 L45.2777778,34.8227273 L81.2118687,34.8227273 Z M113.194444,34.7815657 L113.194444,38.8977273 L99.6111111,38.8977273 L99.6111111,34.7815657 L113.194444,34.7815657 Z M153.944444,34.7815657 L153.944444,38.8977273 L140.361111,38.8977273 L140.361111,34.7815657 L153.944444,34.7815657 Z M137.397475,34.7815657 L135.915657,38.8977273 L117.639899,38.8977273 L116.158081,34.7815657 L137.397475,34.7815657 Z M22.6388889,26.1787879 L22.6388889,30.2949495 L9.05555556,30.2949495 L9.05555556,26.1787879 L22.6388889,26.1787879 Z M84.5459596,26.1787879 C83.640404,27.7017677 82.5290404,29.1012626 81.2118687,30.2949495 L81.2118687,30.2949495 L45.2777778,30.2949495 L45.2777778,26.1787879 L84.5459596,26.1787879 Z M153.944444,26.1376263 L153.944444,30.2537879 L140.361111,30.2537879 L140.361111,26.3434343 L138.961616,30.2537879 L127.065909,30.2537879 L128.465404,26.1376263 L153.944444,26.1376263 Z M125.090152,26.1376263 L126.489646,30.2537879 L114.593939,30.2537879 L113.194444,26.3434343 L113.194444,30.2537879 L99.6111111,30.2537879 L99.6111111,26.1376263 L125.090152,26.1376263 Z M22.6388889,17.5348485 L22.6388889,21.6510101 L9.05555556,21.6510101 L9.05555556,17.5348485 L22.6388889,17.5348485 Z M58.8611111,17.5348485 L58.8611111,21.6510101 L45.2777778,21.6510101 L45.2777778,17.5348485 L58.8611111,17.5348485 Z M86.8510101,17.5348485 C86.8510101,18.9343434 86.6863636,20.3338384 86.3570707,21.6510101 L86.3570707,21.6510101 L72.4444444,21.6510101 L72.4444444,17.5348485 L86.8510101,17.5348485 Z M153.944444,17.4936869 L153.944444,21.6098485 L130.070707,21.6098485 L131.470202,17.4936869 L153.944444,17.4936869 Z M122.085354,17.4936869 L123.484848,21.6098485 L99.6111111,21.6098485 L99.6111111,17.4936869 L122.085354,17.4936869 Z M31.6944444,8.89090909 L31.6944444,13.0070707 L1.70388148e-11,13.0070707 L1.70388148e-11,8.89090909 L31.6944444,8.89090909 Z M84.504798,8.89090909 C85.2457071,10.1669192 85.8219697,11.5664141 86.2335859,13.0070707 L86.2335859,13.0070707 L36.2222222,13.0070707 L36.2222222,8.89090909 L84.504798,8.89090909 Z M163,8.84974747 L163,12.9659091 L133.034343,12.9659091 L134.475,8.84974747 L163,8.84974747 Z M119.080556,8.84974747 L120.521212,12.9659091 L90.5555556,12.9659091 L90.5555556,8.84974747 L119.080556,8.84974747 Z M31.6944444,0.246969697 L31.6944444,4.36313131 L1.70388148e-11,4.36313131 L1.70388148e-11,0.246969697 L31.6944444,0.246969697 Z M69.5631313,0.246969697 L70.0046301,0.252525646 C74.1125422,0.356016166 77.8579067,1.89911181 80.7590909,4.36313131 L80.7590909,4.36313131 L36.2222222,4.36313131 L36.2222222,0.246969697 L69.5631313,0.246969697 Z M163,0.205808081 L163,4.3219697 L136.039141,4.3219697 L137.479798,0.205808081 L163,0.205808081 Z M116.075758,0.205808081 L117.516414,4.3219697 L90.5555556,4.3219697 L90.5555556,0.205808081 L116.075758,0.205808081 Z"/></g></g></g></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Java Microservices with Security Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 2. Secure microservices using Authentication with mTLS
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/ibm/cloud-native-starter-security-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cloud-native-starter-security-workshop
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Java Microservices with Security Workshop" class="md-nav__button md-logo" aria-label="Java Microservices with Security Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="180" height="85" version="1.1" viewBox="0 0 180 85"><title>ibm_8bar_gray10_on_teal90</title><g id="Page-1" fill="none" fill-rule="evenodd" stroke="none" stroke-width="1"><g id="ibm_8bar_gray10_on_teal90" fill-rule="nonzero"><rect id="Rectangle-5-Copy-14" width="180" height="85" x="0" y="0" fill="#000"/><g id="8-bar-/-reverse" fill="#F3F3F3" transform="translate(8.500000, 9.500000)"><path id="Combined-Shape" d="M31.6944444,60.7545455 L31.6944444,64.8707071 L1.70388148e-11,64.8707071 L1.70388148e-11,60.7545455 L31.6944444,60.7545455 Z M80.7590909,60.7545455 C77.7542929,63.3065657 73.8439394,64.8707071 69.5631313,64.8707071 L69.5631313,64.8707071 L36.2222222,64.8707071 L36.2222222,60.7545455 L80.7590909,60.7545455 Z M113.194444,60.7133838 L113.194444,64.8295455 L90.5555556,64.8295455 L90.5555556,60.7133838 L113.194444,60.7133838 Z M163,60.7133838 L163,64.8295455 L140.361111,64.8295455 L140.361111,60.7133838 L163,60.7133838 Z M128.218434,60.7133838 L126.777778,64.7883838 L125.337121,60.7133838 L128.218434,60.7133838 Z M86.2747475,52.1106061 C85.8631313,53.5512626 85.2868687,54.9507576 84.5459596,56.2267677 L84.5459596,56.2267677 L36.2222222,56.2267677 L36.2222222,52.1106061 L86.2747475,52.1106061 Z M31.6944444,52.1106061 L31.6944444,56.2267677 L1.70388148e-11,56.2267677 L1.70388148e-11,52.1106061 L31.6944444,52.1106061 Z M113.194444,52.0694444 L113.194444,56.1856061 L90.5555556,56.1856061 L90.5555556,52.0694444 L113.194444,52.0694444 Z M163,52.0694444 L163,56.1856061 L140.361111,56.1856061 L140.361111,52.0694444 L163,52.0694444 Z M131.264394,52.0694444 L129.823737,56.1856061 L123.731818,56.1856061 L122.291162,52.0694444 L131.264394,52.0694444 Z M22.6388889,43.4666667 L22.6388889,47.5828283 L9.05555556,47.5828283 L9.05555556,43.4666667 L22.6388889,43.4666667 Z M58.8611111,43.4666667 L58.8611111,47.5828283 L45.2777778,47.5828283 L45.2777778,43.4666667 L58.8611111,43.4666667 Z M86.3570707,43.4666667 C86.6863636,44.7838384 86.8510101,46.1833333 86.8510101,47.5828283 L86.8510101,47.5828283 L72.4444444,47.5828283 L72.4444444,43.4666667 L86.3570707,43.4666667 Z M113.194444,43.4255051 L113.194444,47.5416667 L99.6111111,47.5416667 L99.6111111,43.4255051 L113.194444,43.4255051 Z M153.944444,43.4255051 L153.944444,47.5416667 L140.361111,47.5416667 L140.361111,43.4255051 L153.944444,43.4255051 Z M134.310354,43.4255051 L132.869697,47.5416667 L120.685859,47.5416667 L119.245202,43.4255051 L134.310354,43.4255051 Z M22.6388889,34.8227273 L22.6388889,38.9388889 L9.05555556,38.9388889 L9.05555556,34.8227273 L22.6388889,34.8227273 Z M81.2118687,34.8227273 C82.5290404,35.9752525 83.640404,37.3747475 84.5459596,38.9388889 L84.5459596,38.9388889 L45.2777778,38.9388889 L45.2777778,34.8227273 L81.2118687,34.8227273 Z M113.194444,34.7815657 L113.194444,38.8977273 L99.6111111,38.8977273 L99.6111111,34.7815657 L113.194444,34.7815657 Z M153.944444,34.7815657 L153.944444,38.8977273 L140.361111,38.8977273 L140.361111,34.7815657 L153.944444,34.7815657 Z M137.397475,34.7815657 L135.915657,38.8977273 L117.639899,38.8977273 L116.158081,34.7815657 L137.397475,34.7815657 Z M22.6388889,26.1787879 L22.6388889,30.2949495 L9.05555556,30.2949495 L9.05555556,26.1787879 L22.6388889,26.1787879 Z M84.5459596,26.1787879 C83.640404,27.7017677 82.5290404,29.1012626 81.2118687,30.2949495 L81.2118687,30.2949495 L45.2777778,30.2949495 L45.2777778,26.1787879 L84.5459596,26.1787879 Z M153.944444,26.1376263 L153.944444,30.2537879 L140.361111,30.2537879 L140.361111,26.3434343 L138.961616,30.2537879 L127.065909,30.2537879 L128.465404,26.1376263 L153.944444,26.1376263 Z M125.090152,26.1376263 L126.489646,30.2537879 L114.593939,30.2537879 L113.194444,26.3434343 L113.194444,30.2537879 L99.6111111,30.2537879 L99.6111111,26.1376263 L125.090152,26.1376263 Z M22.6388889,17.5348485 L22.6388889,21.6510101 L9.05555556,21.6510101 L9.05555556,17.5348485 L22.6388889,17.5348485 Z M58.8611111,17.5348485 L58.8611111,21.6510101 L45.2777778,21.6510101 L45.2777778,17.5348485 L58.8611111,17.5348485 Z M86.8510101,17.5348485 C86.8510101,18.9343434 86.6863636,20.3338384 86.3570707,21.6510101 L86.3570707,21.6510101 L72.4444444,21.6510101 L72.4444444,17.5348485 L86.8510101,17.5348485 Z M153.944444,17.4936869 L153.944444,21.6098485 L130.070707,21.6098485 L131.470202,17.4936869 L153.944444,17.4936869 Z M122.085354,17.4936869 L123.484848,21.6098485 L99.6111111,21.6098485 L99.6111111,17.4936869 L122.085354,17.4936869 Z M31.6944444,8.89090909 L31.6944444,13.0070707 L1.70388148e-11,13.0070707 L1.70388148e-11,8.89090909 L31.6944444,8.89090909 Z M84.504798,8.89090909 C85.2457071,10.1669192 85.8219697,11.5664141 86.2335859,13.0070707 L86.2335859,13.0070707 L36.2222222,13.0070707 L36.2222222,8.89090909 L84.504798,8.89090909 Z M163,8.84974747 L163,12.9659091 L133.034343,12.9659091 L134.475,8.84974747 L163,8.84974747 Z M119.080556,8.84974747 L120.521212,12.9659091 L90.5555556,12.9659091 L90.5555556,8.84974747 L119.080556,8.84974747 Z M31.6944444,0.246969697 L31.6944444,4.36313131 L1.70388148e-11,4.36313131 L1.70388148e-11,0.246969697 L31.6944444,0.246969697 Z M69.5631313,0.246969697 L70.0046301,0.252525646 C74.1125422,0.356016166 77.8579067,1.89911181 80.7590909,4.36313131 L80.7590909,4.36313131 L36.2222222,4.36313131 L36.2222222,0.246969697 L69.5631313,0.246969697 Z M163,0.205808081 L163,4.3219697 L136.039141,4.3219697 L137.479798,0.205808081 L163,0.205808081 Z M116.075758,0.205808081 L117.516414,4.3219697 L90.5555556,4.3219697 L90.5555556,0.205808081 L116.075758,0.205808081 Z"/></g></g></g></svg>

    </a>
    Java Microservices with Security Workshop
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ibm/cloud-native-starter-security-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cloud-native-starter-security-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About the workshop
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Setup IBM Cloud
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Setup IBM Cloud" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Setup IBM Cloud
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pre-work/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pre-work/CLOUD_ACCOUNT/" class="md-nav__link">
        Access the Cluster
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../pre-work/CLOUD_SHELL/" class="md-nav__link">
        Access IBM Cloud Shell and get the code
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Setup Application environment
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Setup Application environment" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Setup Application environment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-env-exercise-01/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-env-exercise-01/SETUP_ISTIO/" class="md-nav__link">
        Lab 1. Setup Istio
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-env-exercise-01/SETUP_ISTIO_INGRESS/" class="md-nav__link">
        Lab 2. Expose Istio Ingress gateway
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-env-exercise-01/SETUP_ISTIO_INGRESS_TLS/" class="md-nav__link">
        Lab 3. Expose the gateway via DNS with TLS enabled
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-env-exercise-01/SETUP_KEYCLOAK/" class="md-nav__link">
        Lab 4. Setup Keycloak
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Platform security with mTLS
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Platform security with mTLS" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Platform security with mTLS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../p-sec-exercise-01/" class="md-nav__link">
        Lab 1. Deploy microservices to Kubernetes
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Lab 2. Secure microservices using Authentication with mTLS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Lab 2. Secure microservices using Authentication with mTLS
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-1-test-permissive-mode" class="md-nav__link">
    TASK 1: Test permissive mode
  </a>
  
    <nav class="md-nav" aria-label="TASK 1: Test permissive mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-a-access-token" class="md-nav__link">
    Step 1: Create a access-token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-get-the-nodeport-of-the-web-api-microservice" class="md-nav__link">
    Step 2: Get the NodePort of the Web-API Microservice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-get-a-external-worker-ip-address-of-the-web-api-microservice" class="md-nav__link">
    Step 3: Get a external Worker IP address of the Web-API Microservice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-use-no-tls-just-http-to-get-the-articles-from-the-web-api-microservice" class="md-nav__link">
    Step 4: Use no TLS just HTTP to get the articles from the Web-API Microservice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-set-mtls-to-strict-in-default-namespace-and-for-services" class="md-nav__link">
    TASK 2: Set mTLS to strict in default namespace and for services
  </a>
  
    <nav class="md-nav" aria-label="TASK 2: Set mTLS to strict in default namespace and for services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-the-following-command-creates-a-peerauthentication-policy-for-the-default-namespace" class="md-nav__link">
    Step 1: The following command creates a PeerAuthentication policy for the default namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-a-new-access-token-and-invoke-the-web-api-microservice-with-http-again" class="md-nav__link">
    Step 2: Create a new access-token and invoke the Web-API Microservice with HTTP again
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../p-sec-exercise-03/" class="md-nav__link">
        (Optional Lab 3) Authorization with Istio
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Authentication and Authorization with Keycloak and Quarkus
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Authentication and Authorization with Keycloak and Quarkus" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Authentication and Authorization with Keycloak and Quarkus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-sec-exercise-01/" class="md-nav__link">
        (Optional Lab 1) Setup the web-application and Microservices locally
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-sec-exercise-01/APPLICATION_AUTHENTICATION/" class="md-nav__link">
        Lab 2. Authentication in Vue.js fronted application
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../app-sec-exercise-01/APPLICATION_AUTHORIZATION/" class="md-nav__link">
        Lab 3. Authorization in Quarkus application
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Additional Resources
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Additional Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Additional Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../additional/additional/" class="md-nav__link">
        Known issues
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../BLOGS/" class="md-nav__link">
        Blog posts related to security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/IBM/cloud-native-starter" class="md-nav__link">
        Cloud-Native-Starter project
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/IBM/cloud-native-starter/security" class="md-nav__link">
        Cloud-Native-Starter project security
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/IBM/cloud-native-starter/security" class="md-nav__link">
        Cloud-Native-Starter project reactive
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://developers.redhat.com/blog/2019/12/11/keycloak-core-concepts-of-open-source-identity-and-access-management/" class="md-nav__link">
        Keycloak core concepts of open-source identity and access management
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-1-test-permissive-mode" class="md-nav__link">
    TASK 1: Test permissive mode
  </a>
  
    <nav class="md-nav" aria-label="TASK 1: Test permissive mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-a-access-token" class="md-nav__link">
    Step 1: Create a access-token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-get-the-nodeport-of-the-web-api-microservice" class="md-nav__link">
    Step 2: Get the NodePort of the Web-API Microservice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-get-a-external-worker-ip-address-of-the-web-api-microservice" class="md-nav__link">
    Step 3: Get a external Worker IP address of the Web-API Microservice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-use-no-tls-just-http-to-get-the-articles-from-the-web-api-microservice" class="md-nav__link">
    Step 4: Use no TLS just HTTP to get the articles from the Web-API Microservice
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-set-mtls-to-strict-in-default-namespace-and-for-services" class="md-nav__link">
    TASK 2: Set mTLS to strict in default namespace and for services
  </a>
  
    <nav class="md-nav" aria-label="TASK 2: Set mTLS to strict in default namespace and for services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-the-following-command-creates-a-peerauthentication-policy-for-the-default-namespace" class="md-nav__link">
    Step 1: The following command creates a PeerAuthentication policy for the default namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-a-new-access-token-and-invoke-the-web-api-microservice-with-http-again" class="md-nav__link">
    Step 2: Create a new access-token and invoke the Web-API Microservice with HTTP again
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm/cloud-native-starter-security-workshop/edit/master/workshop/p-sec-exercise-02/README.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="secure-microservices-with-strict-mtls">Secure microservices with strict mTLS<a class="headerlink" href="#secure-microservices-with-strict-mtls" title="Permanent link">&para;</a></h1>
<p>Istio uses <em>Mutual authentication with Transport Layer Security (mTLS)</em> to secure the communication between microservices without requiring application code changes. Security is provided by authenticating and encrypting communication paths within the cluster. This is becoming a common security and compliance requirement. Delegating communication security to Istio (as opposed to implementing TLS in each microservice) ensures that your application will be deployed with consistent and manageable security policies.</p>
<p>This exercise will cover only a part of the Istio security features. The Istio documentation has a lot more information.</p>
<p>Istio provides each Envoy sidecar proxy with a strong (cryptographic) identity, in the form of a certificate created by Istios own Certificate Authority (CA).</p>
<p><img alt="" src="../images/Istio-CA.png" /></p>
<p>This identity is based on the microservice's service account and is independent of its specific network location, such as cluster or current IP address. This is called Secure naming. Envoys then use the certificates to identify each other and establish an authenticated and encrypted communication channel between them.</p>
<p>Istio is responsible for:</p>
<ul>
<li>Providing each service with an identity representing its role.</li>
<li>Providing a common trust root to allow Envoys to validate and authenticate each other.</li>
<li>Providing a key management system, automating generation, distribution, and rotation of certificates and keys.</li>
</ul>
<p>When an application microservice connects to another microservice, the communication is redirected through the client side and server side Envoys. The end-to-end communication path is:</p>
<ul>
<li>
<p>Local TCP connection (i.e., localhost, not reaching the "wire") between the application and Envoy (client- and server-side);</p>
</li>
<li>
<p>Mutually authenticated and encrypted connection between Envoy proxies.</p>
</li>
</ul>
<p>This includes the Istio Ingress for incoming (and the Istio Egress for outgoing) connections. Your Kubernetes cluster may/will have its own ingress but this ingress is not paired with an Envoy sidecar and therefore is not able to directly participate in secure and encrypted communications.</p>
<p><img alt="" src="../images/Istio-mTLS.png" /></p>
<p>mTLS is enabled by default for the communication between Envoys <strong>but it is enabled in permissive mode</strong>. This means that a microservice outside of the Istio Service Mesh, one without a Envoy proxy, can communicate with a microservice within the Service Mesh. This allows you to bring your microservices into the Service Mesh and then gradually turn on and test security.</p>
<h3 id="task-1-test-permissive-mode"><strong>TASK 1: Test permissive mode</strong><a class="headerlink" href="#task-1-test-permissive-mode" title="Permanent link">&para;</a></h3>
<p>In this task we access the Web-API service using the services nodeport, the IP address of a worker node, and unencrypted HTTP, effectively bypassing the Istio Ingress This is only possible because Istio is still using mTLS in permissive mode.</p>
<h4 id="step-1-create-a-access-token">Step 1: Create a access-token<a class="headerlink" href="#step-1-create-a-access-token" title="Permanent link">&para;</a></h4>
<p>We need a JSON Web Token (JWT) to access the service:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">access_token</span><span class="o">=</span><span class="k">$(</span>curl -d <span class="s2">&quot;username=alice&quot;</span> -d <span class="s2">&quot;password=alice&quot;</span> -d <span class="s2">&quot;grant_type=password&quot;</span> -d <span class="s2">&quot;client_id=frontend&quot;</span> https://<span class="nv">$INGRESSURL</span>/auth/realms/quarkus/protocol/openid-connect/token  <span class="p">|</span> sed -n <span class="s1">&#39;s|.*&quot;access_token&quot;:&quot;\([^&quot;]*\)&quot;.*|\1|p&#39;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$access_token</span>
</code></pre></div>
<p><em>Note:</em> REMEMBER that an access-token is only valid for 60 seconds ;-). You need to be quick with the next steps otherwise the token will already be involid!</p>
<h4 id="step-2-get-the-nodeport-of-the-web-api-microservice">Step 2: Get the NodePort of the Web-API Microservice<a class="headerlink" href="#step-2-get-the-nodeport-of-the-web-api-microservice" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">nodeport</span><span class="o">=</span><span class="k">$(</span>kubectl get svc web-api --ignore-not-found --output <span class="s1">&#39;jsonpath={.spec.ports[*].nodePort}&#39;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$nodeport</span>
</code></pre></div>
<h4 id="step-3-get-a-external-worker-ip-address-of-the-web-api-microservice">Step 3: Get a external Worker IP address of the Web-API Microservice<a class="headerlink" href="#step-3-get-a-external-worker-ip-address-of-the-web-api-microservice" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">workerip</span><span class="o">=</span><span class="k">$(</span>ibmcloud ks workers --cluster <span class="nv">$MYCLUSTER</span> <span class="p">|</span> awk <span class="s1">&#39;/Ready/ {print $2;exit;}&#39;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$workerip</span>
</code></pre></div>
<p>We now have an external IP address and port to access the Web-API service.</p>
<h4 id="step-4-use-no-tls-just-http-to-get-the-articles-from-the-web-api-microservice">Step 4: Use no TLS just <code>HTTP</code> to get the articles from the Web-API Microservice<a class="headerlink" href="#step-4-use-no-tls-just-http-to-get-the-articles-from-the-web-api-microservice" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>curl -i http://<span class="nv">$workerip</span>:<span class="nv">$nodeport</span>/articles -H <span class="s2">&quot;Authorization: Bearer </span><span class="nv">$access_token</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 <span class="m">200</span> OK
cache-control: no-cache
content-length: <span class="m">1663</span>
content-type: application/json
x-envoy-upstream-service-time: <span class="m">60</span>
x-envoy-peer-metadata: CjgKDElOU1RBTkNF*****kaB3dlYi1hcGk<span class="o">=</span>
x-envoy-peer-metadata-id: sidecar~172.30.83.82~web-api-5c9698b875-sn9ck.default~default.svc.cluster.local
date: Wed, <span class="m">05</span> Aug <span class="m">2020</span> <span class="m">14</span>:15:57 GMT
server: istio-envoy
x-envoy-decorator-operation: web-api.default.svc.cluster.local:8081/*

<span class="o">[{</span><span class="s2">&quot;authorBlog&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;authorTwitter&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Blue Cloud Mirror — (Don’t) Open The Doors!&quot;</span>,<span class="s2">&quot;url&quot;</span>:<span class="s2">&quot;https://haralduebele.blog/2019/02/17/blue-cloud-mirror-dont-open-the-doors/&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;authorBlog&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;authorTwitter&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Recent Java Updates from IBM&quot;</span>,<span class="s2">&quot;url&quot;</span>:<span class="s2">&quot;http://heidloff.net/article/recent-java-updates-from-ibm&quot;</span><span class="o">}</span>,******* <span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Three awesome TensorFlow.js Models for Visual Recognition&quot;</span>,<span class="s2">&quot;url&quot;</span>:<span class="s2">&quot;http://heidloff.net/article/tensorflowjs-visual-recognition&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;authorBlog&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;authorTwitter&quot;</span>:<span class="s2">&quot;&quot;</span><span class="o">]</span>
</code></pre></div>
<p>As result of the last command you can see an HTTP status of 200 which means OK and the correct result, a list of blog articles as a JSON object.</p>
<p>This is not totally unsecure since we needed an access token (JWT) to make the REST call but we were able to access the service using http only on port 80. Somebody with access to the cluster and the required skills could stage a man-in-the-middle attack and read the data because it is not encrypted.</p>
<p>We are going to change this in the next step.</p>
<h3 id="task-2-set-mtls-to-strict-in-default-namespace-and-for-services"><strong>TASK 2: Set mTLS to strict in default namespace and for services</strong><a class="headerlink" href="#task-2-set-mtls-to-strict-in-default-namespace-and-for-services" title="Permanent link">&para;</a></h3>
<p>By switching mTLS to strict mode it is impossible for external traffic to bypass the Istio Ingress. External traffic means external to the Kubernetes cluster (coming from the outside) or external to the default namespace, i.e. not being part of the servie mesh.</p>
<p>This is the reason why we installed Keycloak into the default namespace: that way it is part of our service mesh and included in the mTLS "dance" automatically. In a real world example you would most likely use a different approach.</p>
<h4 id="step-1-the-following-command-creates-a-peerauthentication-policy-for-the-default-namespace">Step 1: The following command creates a PeerAuthentication policy for the <code>default</code> namespace<a class="headerlink" href="#step-1-the-following-command-creates-a-peerauthentication-policy-for-the-default-namespace" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> <span class="nv">$ROOT_FOLDER</span>/IKS
kubectl apply -f mtls.yaml
</code></pre></div>
<p>This enforces mTLS in the <code>default</code> namespace. So simple!</p>
<h4 id="step-2-create-a-new-access-token-and-invoke-the-web-api-microservice-with-http-again">Step 2: Create a new access-token and invoke the Web-API Microservice with <code>HTTP</code> again<a class="headerlink" href="#step-2-create-a-new-access-token-and-invoke-the-web-api-microservice-with-http-again" title="Permanent link">&para;</a></h4>
<p>As you will see, you can no longer access the service, even if you know its NodePort and the external IP of a Kubernetess worker node.</p>
<ul>
<li>Create access-token</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">access_token</span><span class="o">=</span><span class="k">$(</span>curl -d <span class="s2">&quot;username=alice&quot;</span> -d <span class="s2">&quot;password=alice&quot;</span> -d <span class="s2">&quot;grant_type=password&quot;</span> -d <span class="s2">&quot;client_id=frontend&quot;</span> https://<span class="nv">$INGRESSURL</span>/auth/realms/quarkus/protocol/openid-connect/token  <span class="p">|</span> sed -n <span class="s1">&#39;s|.*&quot;access_token&quot;:&quot;\([^&quot;]*\)&quot;.*|\1|p&#39;</span><span class="k">)</span>
<span class="nb">echo</span> <span class="nv">$access_token</span>
</code></pre></div>
<ul>
<li>Invoke Web-API Microservice</li>
</ul>
<div class="highlight"><pre><span></span><code>curl -i http://<span class="nv">$workerip</span>:<span class="nv">$nodeport</span>/articles -H <span class="s2">&quot;Authorization: Bearer </span><span class="nv">$access_token</span><span class="s2">&quot;</span>
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code>curl: <span class="o">(</span><span class="m">56</span><span class="o">)</span> Recv failure: Connection reset by peer
</code></pre></div>
<p>Now everything is secure.</p>
<p>If you check the Cloud Native Starter frontend in the browser, nothing should have changed because it already used enrypted paths:</p>
<ul>
<li>Access to the <code>Web-App</code> (service) is through the Istio Ingress gateway using https (loading the JavaScript/Vue.js code into the browser)</li>
<li>The (external) <code>Web-App</code> in the browser is accessing the <code>Keycloak</code> server and the Web-API service using https</li>
<li>Those requests come in through the Istio Ingress gateway</li>
<li>Since the <code>Istio Ingress gateway</code>, <code>Keycloak</code>, and <code>Web-API</code> are all part of the service mesh, communication between them is already encrypted using <code>mTLS</code></li>
<li>REST API calls from <code>Web-API</code> to <code>Articles</code> and from <code>Web-API</code> or <code>Articles</code> to <code>Keycloak</code> use <code>mTLS</code></li>
<li>Access from outside into the applications/services running in the <code>default</code> namespace is prohibited now by enforcing strict <code>mTLS</code>. You can only access the services through the Istio Ingress.</li>
</ul>
<p>This is the result of your work so far:</p>
<p><img alt="" src="../images/IstioSecurityArchitecture.png" /></p>
<blockquote>
<p><em>Note:</em> The image shows you in Kiali <code>mTLS</code> is enabled on the http connections. <em>This is not a part of your hands-on tasks.</em></p>
</blockquote>
<p><img alt="" src="../images/kiali-ingress-mtls.png" /></p>
<hr />
<blockquote>
<p>Congratulations, you have successfully completed this lab and reached the end of the <code>Platform security with mTLS</code> section of the workshop. Awesome <img alt="⭐" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/2b50.svg" title=":star:" /></p>
</blockquote>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../p-sec-exercise-01/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Lab 1. Deploy microservices to Kubernetes
            </div>
          </div>
        </a>
      
      
        <a href="../p-sec-exercise-03/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              (Optional Lab 3) Authorization with Istio
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 IBM Developer
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/ibm" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/ibmdeveloper" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/company/ibm/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.youtube.com/user/developerworks" target="_blank" rel="noopener" title="www.youtube.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://dev.to/ibmdeveloper" target="_blank" rel="noopener" title="dev.to" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.a1609d9a.min.js"></script>
      
    
  </body>
</html>